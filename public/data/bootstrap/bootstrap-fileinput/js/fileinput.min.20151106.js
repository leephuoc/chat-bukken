(function(e){e.fn.fileinputLocales={};String.prototype.repl=function(a,b){return this.split(a).join(b)};var F=function(a){var b=document.createElement("div");b.innerHTML="\x3c!--[if IE "+a+"]><i></i><![endif]--\x3e";a=1===b.getElementsByTagName("i").length;document.body.appendChild(b);b.parentNode.removeChild(b);return a},l={data:{},init:function(a){var b=a.initialPreview,c=a.id;0<b.length&&!K(b)&&(b=b.split(a.initialPreviewDelimiter));l.data[c]={content:b,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags,
delimiter:a.initialPreviewDelimiter,template:a.previewGenericTemplate,msg:function(b){return a.getMsgSelected(b)},initId:a.previewInitId,footer:a.getLayoutTemplate("footer"),isDelete:a.initialPreviewShowDelete,caption:a.initialCaption,actions:function(b,c,f,e,k){return a.renderFileActions(b,c,f,e,k)}}},fetch:function(a){return l.data[a].content.filter(function(a){return null!==a})},count:function(a,b){return l.data[a]&&l.data[a].content?b?l.data[a].content.length:l.fetch(a).length:0},get:function(a,
b,c){var d="init_"+b,g=l.data[a],f=g.config[b],n=g.initId+"-"+d,k=" file-preview-initial";c=void 0===c?!0:c;if(null===g.content[b])return"";h(f)||h(f.frameClass)||(k+=" "+f.frameClass);a=g.template.repl("{previewId}",n).repl("{frameClass}",k).repl("{fileindex}",d).repl("{content}",g.content[b]).repl("{footer}",l.footer(a,b,c));g.tags.length&&g.tags[b]&&(a=G(a,g.tags[b]));h(f)||h(f.frameAttr)||(b=e(document.createElement("div")).html(a),b.find(".file-preview-initial").attr(f.frameAttr),a=b.html(),
b.remove());return a},add:function(a,b,c,d,g){var f=e.extend(!0,{},l.data[a]);K(b)||(b=b.split(f.delimiter));g?(g=f.content.push(b)-1,f.config[g]=c,f.tags[g]=d):(g=b.length,f.content=b,f.config=c,f.tags=d);l.data[a]=f;return g},set:function(a,b,c,d,g){var f=e.extend(!0,{},l.data[a]);K(b)||(b=b.split(f.delimiter));if(g){for(g=0;g<b.length;g++)f.content.push(b[g]);for(g=0;g<c.length;g++)f.config.push(c[g]);for(g=0;g<d.length;g++)f.tags.push(d[g])}else f.content=b,f.config=c,f.tags=d;l.data[a]=f},unset:function(a,
b){var c=l.count(a);c&&(1===c?(l.data[a].content=[],l.data[a].config=[]):(l.data[a].content[b]=null,l.data[a].config[b]=null))},out:function(a){var b="",c=l.data[a],d=l.count(a,!0);if(0===d)return{content:"",caption:""};for(var g=0;g<d;g++)b+=l.get(a,g);a=c.msg(l.count(a));return{content:b,caption:a}},footer:function(a,b,c){a=l.data[a];c=void 0===c?!0:c;if(0===a.config.length||h(a.config[b]))return"";var d=a.config[b];b=A("caption",d)?d.caption:"";var g=A("width",d)?d.width:"auto",f=A("url",d)?d.url:
!1,d=A("key",d)?d.key:null;c=a.isDelete?a.actions(!1,!0,!1===f&&c,f,d):"";return a.footer.repl("{actions}",c).repl("{caption}",b).repl("{width}",g).repl("{indicator}","").repl("{indicatorTitle}","")}},V=function(){var a=document.createElement("div");return!F(9)&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},r=function(a,b){a.removeClass(b).addClass(b)},W={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",
uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",
indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},R={main1:'{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',main2:'{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',preview:'<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',
icon:'<span class="glyphicon glyphicon-file kv-caption-icon"></span>',caption:'<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',modal:'<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',
progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',footer:'<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}</div>\n    {actions}\n</div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',
actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n'},S={generic:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',html:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <div class="file-preview-other">\n       {previewFileIcon}\n   </div>\n    </object>\n   {footer}\n</div>',
image:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" style="width:{width};height:{height};">\n   {footer}\n</div>\n',text:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" style="width:{width};height:{height};">\n       {data}\n   </div>\n   {footer}\n</div>',video:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" style="width:{width};height:{height};">\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       <div class="file-preview-other">\n       {previewFileIcon}\n   </div>\n   </video>\n   {footer}\n</div>\n',
audio:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" style="width:{width};height:{height};">\n   <audio controls>\n       <source src="{data}" type="{type}">\n       <div class="file-preview-other">\n       {previewFileIcon}\n   </div>\n   </audio>\n   {footer}\n</div>',flash:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" style="width:{width};height:{height};">\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n       <div class="file-preview-other">\n       {previewFileIcon}\n   </div>\n   </object>\n   {footer}\n</div>\n',
object:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" style="width:{width};height:{height};">\n   <div class="file-preview-other">\n       {previewFileIcon}\n   </div>\n   {footer}\n</div>',other:'<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" style="width:{width};height:{height};">\n   <div class="file-preview-other">\n       {previewFileIcon}\n   </div>\n   {footer}\n</div>'},
H="image html text video audio flash object".split(" "),P={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},Q={image:function(a,b){return void 0!==a?a.match("image.*"):b.match(/\.(gif|png|jpe?g)$/i)},html:function(a,b){return void 0!==a?"text/html"===a:b.match(/\.(htm|html)$/i)},
text:function(a,b){return void 0!==a&&a.match("text.*")||b.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(a,b){return void 0!==a&&a.match(/\.video\/(ogg|mp4|webm)$/i)||b.match(/\.(og?|mp4|webm)$/i)},audio:function(a,b){return void 0!==a&&a.match(/\.audio\/(ogg|mp3|wav)$/i)||b.match(/\.(ogg|mp3|wav)$/i)},flash:function(a,b){return void 0!==a&&"application/x-shockwave-flash"===a||b.match(/\.(swf)$/i)},object:function(){return!0},other:function(){return!0}},h=function(a,b){return null===a||void 0===
a||0===a.length||b&&""===e.trim(a)},K=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},A=function(a,b){return"object"===typeof b&&a in b},y=function(a,b,c){return h(a)||h(a[b])?c:e(a[b])},M=function(){return Math.round((new Date).getTime()+100*Math.random())},G=function(a,b){var c=a;b=b||{};e.each(b,function(a,b){"function"===typeof b&&(b=b());c=c.repl(a,b)});return c},N=window.URL||window.webkitURL,O=function(a,b){this.$element=e(a);this.validate()&&(this.isPreviewable=
window.File&&window.FileReader,this.isIE9=F(9),this.isIE10=F(10),this.isPreviewable||this.isIE9?(this.init(b),this.listen()):this.$element.removeClass("file-loading"))};O.prototype={constructor:O,validate:function(){if("file"===this.$element.attr("type"))return!0;this.$element.after('<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>');return!1},init:function(a){var b=this,
c=b.$element;e.each(a,function(a,c){var f;if("maxFileCount"===a||"maxFileSize"===a){f=c;var e;e=0;"number"!==typeof f&&("string"===typeof f&&(f=parseFloat(f)),f=isNaN(f)?e:f)}else f=c;b[a]=f});b.fileInputCleared=!1;b.fileBatchCompleted=!0;h(b.allowedPreviewTypes)&&(b.allowedPreviewTypes=H);b.isPreviewable||(b.showPreview=!1);b.uploadFileAttr=h(c.attr("name"))?"file_data":c.attr("name");b.reader=null;b.formdata={};b.filestack=[];b.ajaxRequests=[];b.isError=!1;b.ajaxAborted=!1;b.dropZoneEnabled=V()&&
b.dropZoneEnabled;b.isDisabled=b.$element.attr("disabled")||b.$element.attr("readonly");b.isUploadable=window.File&&window.FileReader&&window.FormData&&!h(b.uploadUrl);b.slug="function"===typeof a.slugCallback?a.slugCallback:b.slugDefault;b.mainTemplate=b.showCaption?b.getLayoutTemplate("main1"):b.getLayoutTemplate("main2");b.captionTemplate=b.getLayoutTemplate("caption");b.previewGenericTemplate=b.getPreviewTemplate("generic");h(b.$element.attr("id"))&&b.$element.attr("id",M());void 0===b.$container?
b.$container=b.createContainer():b.refreshContainer();b.$progress=b.$container.find(".kv-upload-progress");b.$btnUpload=b.$container.find(".kv-fileinput-upload");b.$captionContainer=y(a,"elCaptionContainer",b.$container.find(".file-caption"));b.$caption=y(a,"elCaptionText",b.$container.find(".file-caption-name"));b.$previewContainer=y(a,"elPreviewContainer",b.$container.find(".file-preview"));b.$preview=y(a,"elPreviewImage",b.$container.find(".file-preview-thumbnails"));b.$previewStatus=y(a,"elPreviewStatus",
b.$container.find(".file-preview-status"));b.$errorContainer=y(a,"elErrorContainer",b.$previewContainer.find(".kv-fileinput-error"));h(b.msgErrorClass)||r(b.$errorContainer,b.msgErrorClass);b.$errorContainer.hide();b.fileActionSettings=e.extend(W,a.fileActionSettings);b.previewInitId="preview-"+M();b.id=b.$element.attr("id");l.init(b);b.initPreview(!0);b.initPreviewDeletes();b.options=a;b.setFileDropZoneTitle();b.uploadCount=0;b.uploadPercent=0;b.$element.removeClass("file-loading");a=b.getLayoutTemplate("progress");
b.progressTemplate=a.replace("{class}",b.progressClass);b.progressCompleteTemplate=a.replace("{class}",b.progressCompleteClass);b.setEllipsis()},parseError:function(a,b,c){b=e.trim(b+"");var d="."===b.slice(-1)?"":".",g=void 0!==a.responseJSON&&void 0!==a.responseJSON.error?a.responseJSON.error:a.responseText;this.showAjaxErrorDetails?(g=e.trim(g.replace(/\n\s*\n/g,"\n")),g=0<g.length?"<pre>"+g+"</pre>":"",b+=d+g):b+=d;return c?"<b>"+c+": </b>"+a:b},raise:function(a,b){var c=e.Event(a);void 0!==b?
this.$element.trigger(c,b):this.$element.trigger(c);if(!c.result)return c.result;switch(a){case "filebatchuploadcomplete":case "filebatchuploadsuccess":case "fileuploaded":case "fileclear":case "filecleared":case "filereset":case "fileerror":case "filefoldererror":case "fileuploaderror":case "filebatchuploaderror":case "filedeleteerror":case "filecustomerror":case "filesuccessremove":break;default:this.ajaxAborted=c.result}return!0},getLayoutTemplate:function(a){a=A(a,this.layoutTemplates)?this.layoutTemplates[a]:
R[a];return h(this.customLayoutTags)?a:G(a,this.customLayoutTags)},getPreviewTemplate:function(a){a=A(a,this.previewTemplates)?this.previewTemplates[a]:S[a];a=a.repl("{previewFileIcon}",this.previewFileIcon);return h(this.customPreviewTags)?a:G(a,this.customPreviewTags)},getOutData:function(a,b,c){a=a||{};b=b||{};c=c||this.filestack.slice(0)||{};return{form:this.formdata,files:c,extra:this.getExtraData(),response:b,reader:this.reader,jqXHR:a}},setEllipsis:function(){var a=this.$captionContainer,b=
this.$caption,c=b.clone().css("height","auto").hide();a.parent().before(c);a.removeClass("kv-has-ellipsis");c.outerWidth()>b.outerWidth()&&a.addClass("kv-has-ellipsis");c.remove()},listen:function(){var a=this,b=a.$element,c=a.$captionContainer,d=a.$btnFile,g=b.closest("form");b.on("change",e.proxy(a.change,a));e(window).on("resize",function(){a.setEllipsis()});d.off("click").on("click",function(){a.raise("filebrowse");a.isError&&!a.isUploadable&&a.clear();c.focus()});g.off("reset").on("reset",e.proxy(a.reset,
a));a.$container.off("click").on("click",".fileinput-remove:not([disabled])",e.proxy(a.clear,a)).on("click",".fileinput-cancel",e.proxy(a.cancel,a));a.isUploadable&&a.dropZoneEnabled&&a.showPreview&&a.initDragDrop();if(!a.isUploadable)g.on("submit",e.proxy(a.submitForm,a));a.$container.find(".kv-fileinput-upload").off("click").on("click",function(b){var c=e(this),d=!c.hasClass("disabled")&&h(c.attr("disabled"));a.isUploadable?(b.preventDefault(),d&&a.upload()):d&&"submit"!==c.attr("type")&&(c=c.closest("form"),
c.length&&c.trigger("submit"),b.preventDefault())})},submitForm:function(){var a=this.$element.get(0).files;return a&&a.length<this.minFileCount&&0<this.minFileCount?(this.noFilesError({}),!1):!this.abort({})},abort:function(a){return this.ajaxAborted&&"object"===typeof this.ajaxAborted&&void 0!==this.ajaxAborted.message?(a=e.extend(this.getOutData(),a),a.abortData=this.ajaxAborted.data||{},a.abortMessage=this.ajaxAborted.message,this.showUploadError(this.ajaxAborted.message,a,"filecustomerror"),
!0):!1},noFilesError:function(a){var b=1<this.minFileCount?this.filePlural:this.fileSingle,b=this.msgFilesTooLess.replace("{n}",this.minFileCount).replace("{files}",b),c=this.$errorContainer;c.html(b);this.isError=!0;this.updateFileDetails(0);c.fadeIn(800);this.raise("fileerror",[a]);this.clearFileInput();r(this.$container,"has-error")},setProgress:function(a){a=Math.min(a,100);var b=100>a?this.progressTemplate:this.progressCompleteTemplate;h(b)||this.$progress.html(b.repl("{percent}",a))},upload:function(){var a=
this.getFileStack().length,b={},c=!e.isEmptyObject(this.getExtraData());if(a<this.minFileCount&&0<this.minFileCount)this.noFilesError(b);else if(this.isUploadable&&!this.isDisabled&&(0!==a||c))if(this.resetUpload(),this.$progress.removeClass("hide"),this.uploadPercent=this.uploadCount=0,this.lock(),this.setProgress(0),0===a&&c)this.uploadExtraOnly();else if(a=this.filestack.length,this.hasInitData=!1,this.uploadAsync&&this.showPreview)for(b=this.getOutData(),this.raise("filebatchpreupload",[b]),this.fileBatchCompleted=
!1,this.uploadCache={content:[],config:[],tags:[],append:!0},b=0;b<a;b+=1)void 0!==this.filestack[b]&&this.uploadSingle(b,this.filestack,!0);else this.uploadBatch()},lock:function(){this.resetErrors();this.disable();this.showRemove&&r(this.$container.find(".fileinput-remove"),"hide");this.showCancel&&this.$container.find(".fileinput-cancel").removeClass("hide");this.raise("filelock",[this.filestack,this.getExtraData()])},unlock:function(a){void 0===a&&(a=!0);this.enable();this.showCancel&&r(this.$container.find(".fileinput-cancel"),
"hide");this.showRemove&&this.$container.find(".fileinput-remove").removeClass("hide");a&&this.resetFileStack();this.raise("fileunlock",[this.filestack,this.getExtraData()])},resetFileStack:function(){var a=this,b=0,c=[];a.getThumbs().each(function(){var d=e(this),g=d.attr("data-fileindex"),f=a.filestack[g];-1!==g&&(void 0!==f?(c[b]=f,d.attr({id:a.previewInitId+"-"+b,"data-fileindex":b}),b+=1):d.attr({id:"uploaded-"+M(),"data-fileindex":"-1"}))});a.filestack=c},refresh:function(a){var b=this.$element,
c=arguments.length?e.extend(this.options,a):this.options;b.off();this.init(c);this.$container.find(".file-drop-zone").off("dragenter dragover dragleave drop");e(document).off("dragenter dragover drop");this.listen();this.setFileDropZoneTitle()},initDragDrop:function(){var a=this,b=a.$container.find(".file-drop-zone");b.off("dragenter dragover dragleave drop");e(document).off("dragenter dragover drop");b.on("dragenter dragover",function(b){var d=-1<e.inArray("Files",b.originalEvent.dataTransfer.types);
b.stopPropagation();b.preventDefault();a.isDisabled||!d?(b.originalEvent.dataTransfer.effectAllowed="none",b.originalEvent.dataTransfer.dropEffect="none"):r(e(this),"highlighted")});b.on("dragleave",function(b){b.stopPropagation();b.preventDefault();a.isDisabled||e(this).removeClass("highlighted")});b.on("drop",function(b){b.preventDefault();a.isDisabled||h(b.originalEvent.dataTransfer.files)||(a.change(b,"dragdrop"),e(this).removeClass("highlighted"))});e(document).on("dragenter dragover drop",function(a){a.stopPropagation();
a.preventDefault()})},setFileDropZoneTitle:function(){var a=this.$container.find(".file-drop-zone");a.find("."+this.dropZoneTitleClass).remove();this.isUploadable&&this.showPreview&&0!==a.length&&!(0<this.getFileStack().length)&&this.dropZoneEnabled&&(0===a.find(".file-preview-frame").length&&a.prepend('<div class="'+this.dropZoneTitleClass+'">'+this.dropZoneTitle+"</div>"),this.$container.removeClass("file-input-new"),r(this.$container,"file-input-ajax-new"))},initFileActions:function(){var a=this;
a.$preview.find(".kv-file-remove").each(function(){var b=e(this),c=b.closest(".file-preview-frame"),d=c.attr("data-fileindex"),g,f;b.off("click").on("click",function(){a.cleanMemory(c);c.fadeOut("slow",function(){a.filestack[d]=void 0;a.clearObjects(c);c.remove();var b=a.getFileStack(!0),e=b.length,m=l.count(a.id);a.clearFileInput();0===e&&0===m?a.reset():(g=m+e,f=1<g?a.getMsgSelected(g):b[0]?b[0].name:"",a.setCaption(f))})})});a.$preview.find(".kv-file-upload").each(function(){var b=e(this);b.off("click").on("click",
function(){var c=b.closest(".file-preview-frame").attr("data-fileindex");a.uploadSingle(c,a.filestack,!1)})})},getMsgSelected:function(a){var b=1===a?this.fileSingle:this.filePlural;return this.msgSelected.replace("{n}",a).replace("{files}",b)},renderFileFooter:function(a,b){var c=this.fileActionSettings,d;d=this.getLayoutTemplate("footer");this.isUploadable?(d=d.repl("{actions}",this.renderFileActions(!0,!0,!1,!1,!1)),c=d.repl("{caption}",a).repl("{width}",b).repl("{indicator}",c.indicatorNew).repl("{indicatorTitle}",
c.indicatorNewTitle)):c=d.repl("{actions}","").repl("{caption}",a).repl("{width}",b).repl("{indicator}","").repl("{indicatorTitle}","");return c=G(c,this.previewThumbTags)},renderFileActions:function(a,b,c,d,g){if(!a&&!b)return"";b=!1===d?"":' data-url="'+d+'"';g=!1===g?"":' data-key="'+g+'"';d=this.getLayoutTemplate("actionDelete");var f="",e=this.getLayoutTemplate("actions"),k=this.otherActionButtons.repl("{dataKey}",g),m=this.fileActionSettings;d=d.repl("{removeClass}",c?m.removeClass+" disabled":
m.removeClass).repl("{removeIcon}",m.removeIcon).repl("{removeTitle}",m.removeTitle).repl("{dataUrl}",b).repl("{dataKey}",g);a&&(f=this.getLayoutTemplate("actionUpload").repl("{uploadClass}",m.uploadClass).repl("{uploadIcon}",m.uploadIcon).repl("{uploadTitle}",m.uploadTitle));return e.repl("{delete}",d).repl("{upload}",f).repl("{other}",k)},setThumbStatus:function(a,b){var c="indicator"+b,d=c+"Title",g="file-preview-"+b.toLowerCase(),f=a.find(".file-upload-indicator"),e=this.fileActionSettings;a.removeClass("file-preview-success file-preview-error file-preview-loading");
f.html(e[c]);f.attr("title",e[d]);a.addClass(g)},clearPreview:function(){(this.showUploadedThumbs?this.$preview.find(".file-preview-frame:not(.file-preview-success)"):this.$preview.find(".file-preview-frame")).remove();this.$preview.find(".file-preview-frame").length&&this.showPreview||this.resetUpload()},initPreview:function(a){var b=this.initialCaption||"",c;l.count(this.id)?(c=l.out(this.id),b=a&&this.initialCaption?this.initialCaption:c.caption,this.$preview.html(c.content),this.setCaption(b),
h(c.content)||this.$container.removeClass("file-input-new")):(this.clearPreview(),a?this.setCaption(b):this.initCaption())},initPreviewDeletes:function(){var a=this,b=a.deleteExtraData||{},c=function(){0===a.$preview.find(".kv-file-remove").length&&(a.reset(),a.initialCaption="")};a.$preview.find(".kv-file-remove").each(function(){var d=e(this),g=d.data("url")||a.deleteUrl,f=d.data("key");if(!h(g)&&void 0!==f){var n=d.closest(".file-preview-frame"),k=l.data[a.id],m,v,p=n.data("fileindex"),q,p=parseInt(p.replace("init_",
"")),k=h(k.config)&&h(k.config[p])?null:k.config[p];q=h(k)||h(k.extra)?b:k.extra;"function"===typeof q&&(q=q());v={id:d.attr("id"),key:f,extra:q};m=e.extend({url:g,type:"DELETE",dataType:"json",data:e.extend({key:f},q),headers:{"X-CSRF-TOKEN":e('meta[name="_token"]').attr("content")},beforeSend:function(b){a.ajaxAborted=!1;a.raise("filepredelete",[f,b,q]);a.ajaxAborted?b.abort():(r(n,"file-uploading"),r(d,"disabled"))},success:function(b,g,e){var m;h(b)||h(b.error)?(l.unset(a.id,p),m=l.count(a.id),
b=0<m?a.getMsgSelected(m):"",a.raise("filedeleted",[f,e,q]),a.setCaption(b),n.removeClass("file-uploading").addClass("file-deleted"),n.fadeOut("slow",function(){a.clearObjects(n);n.remove();c();m||0!==a.getFileStack().length||(a.setCaption(""),a.reset())})):(v.jqXHR=e,v.response=b,a.showError(b.error,v,"filedeleteerror"),n.removeClass("file-uploading"),d.removeClass("disabled"),c())},error:function(b,d,f){d=a.parseError(b,f);v.jqXHR=b;v.response={};a.showError(d,v,"filedeleteerror");n.removeClass("file-uploading");
c()}},a.ajaxDeleteSettings);d.off("click").on("click",function(){e.ajax(m)})}})},clearObjects:function(a){a.find("video audio").each(function(){this.pause();e(this).remove()});a.find("img object div").each(function(){e(this).remove()})},clearFileInput:function(){var a=this.$element,b,c,d;h(a.val())||(this.isIE9||this.isIE10?(b=a.closest("form"),c=e(document.createElement("form")),d=e(document.createElement("div")),a.before(d),b.length?b.after(c):d.after(c),c.append(a).trigger("reset"),d.before(a).remove(),
c.remove()):a.val(""),this.fileInputCleared=!0)},resetUpload:function(){this.uploadCache={content:[],config:[],tags:[],append:!0};this.uploadPercent=this.uploadCount=0;this.$btnUpload.removeAttr("disabled");this.setProgress(0);r(this.$progress,"hide");this.resetErrors(!1);this.ajaxAborted=!1;this.ajaxRequests=[]},cancel:function(){var a=this,b=a.ajaxRequests,c=b.length,d;if(0<c)for(d=0;d<c;d+=1)b[d].abort();a.getThumbs().each(function(){var b=e(this),c=b.attr("data-fileindex");b.removeClass("file-uploading");
void 0!==a.filestack[c]&&(b.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),b.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));a.unlock()})},cleanMemory:function(a){a=a.is("img")?a.attr("src"):a.find("source").attr("src");N.revokeObjectURL(a)},hasInitialPreview:function(){return!this.overwriteInitial&&l.count(this.id)},clear:function(){var a=this,b;a.$btnUpload.removeAttr("disabled");a.getThumbs().find("video,audio,img").each(function(){a.cleanMemory(e(this))});
a.resetUpload();a.filestack=[];a.clearFileInput();a.resetErrors(!0);a.raise("fileclear");a.hasInitialPreview()?(a.showFileIcon(),a.resetPreview(),a.setEllipsis(),a.initPreviewDeletes(),a.$container.removeClass("file-input-new")):(a.getThumbs().each(function(){a.clearObjects(e(this))}),a.$preview.html(""),b=!a.overwriteInitial&&0<a.initialCaption.length?a.initialCaption:"",a.setCaption(b),a.setEllipsis(),a.$caption.attr("title",""),r(a.$container,"file-input-new"));0===a.$container.find(".file-preview-frame").length&&
(a.initCaption()||a.$captionContainer.find(".kv-caption-icon").hide(),a.setEllipsis());a.hideFileIcon();a.raise("filecleared");a.$captionContainer.focus();a.setFileDropZoneTitle()},resetPreview:function(){var a;l.count(this.id)?(a=l.out(this.id),this.$preview.html(a.content),this.setCaption(a.caption)):(this.clearPreview(),this.initCaption())},reset:function(){this.resetPreview();this.setEllipsis();this.$container.find(".fileinput-filename").text("");this.raise("filereset");0<this.initialPreview.length&&
this.$container.removeClass("file-input-new");this.setFileDropZoneTitle();this.filestack=[];this.formdata={}},disable:function(){this.isDisabled=!0;this.raise("filedisabled");this.$element.attr("disabled","disabled");this.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled");this.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",!0);this.initDragDrop()},enable:function(){this.isDisabled=!1;this.raise("fileenabled");this.$element.removeAttr("disabled");
this.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled");this.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled");this.initDragDrop()},getThumbs:function(a){return this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+(a||""))},getExtraData:function(){var a=this.uploadExtraData;"function"===typeof this.uploadExtraData&&(a=this.uploadExtraData());return a},uploadExtra:function(){var a=this,b=a.getExtraData();0!==b.length&&
e.each(b,function(b,d){a.formdata.append(b,d)})},initXhr:function(a,b){var c=this;a.upload&&a.upload.addEventListener("progress",function(a){var g=0,f=a.loaded||a.position,e=a.total;a.lengthComputable&&(g=Math.ceil(f/e*b));c.uploadPercent=Math.max(g,c.uploadPercent);c.setProgress(c.uploadPercent)},!1);return a},ajaxSubmit:function(a,b,c,d){var g=this;g.uploadExtra();a=e.extend({xhr:function(){var a=e.ajaxSettings.xhr();return g.initXhr(a,98)},url:g.uploadUrl,type:"POST",headers:{"X-CSRF-TOKEN":e('meta[name="_token"]').attr("content")},
dataType:"json",data:g.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:a,success:b,complete:c,error:d},g.ajaxSettings);g.ajaxRequests.push(e.ajax(a))},initUploadSuccess:function(a,b,c){var d=this,g,f,n,k;"object"===typeof a&&!e.isEmptyObject(a)&&void 0!==a.initialPreview&&0<a.initialPreview.length&&(d.hasInitData=!0,f=a.initialPreview||[],n=a.initialPreviewConfig||[],k=a.initialPreviewThumbTags||[],a=void 0===a.append||a.append?!0:!1,d.overwriteInitial=!1,void 0===b||c?c?(d.uploadCache.content.push(f[0]),
d.uploadCache.config.push(n[0]),d.uploadCache.tags.push(k[0]),d.uploadCache.append=a):(l.set(d.id,f,n,k,a),d.initPreview(),d.initPreviewDeletes()):(c=l.add(d.id,f,n[0],k[0],a),c=l.get(d.id,c,!1),g=e(c).hide(),b.after(g).fadeOut("slow",function(){g.fadeIn("slow").css("display:inline-block");d.initPreviewDeletes();d.clearFileInput();b.remove()})))},initSuccessThumbs:function(){var a=this;a.getThumbs(".file-preview-success").each(function(){var b=e(this);b.find(".kv-file-remove").removeAttr("disabled").off("click").on("click",
function(){var c=a.raise("filesuccessremove",[b.attr("id"),b.data("fileindex")]);a.cleanMemory(b);!1!==c&&b.fadeOut("slow",function(){b.remove();a.$preview.find(".file-preview-frame").length||a.reset()})})})},uploadSingle:function(a,b,c){var d=this,g=d.getFileStack().length,f=new FormData,n,k=d.previewInitId+"-"+a,m=e("#"+k+":not(.file-preview-initial)"),v,p,q=m.find(".kv-file-upload"),T=m.find(".kv-file-remove"),U,B=0<d.filestack.length||!e.isEmptyObject(d.uploadExtraData),L,w,C,t,u={id:k,index:a};
d.formdata=f;0===g||!B||q.hasClass("disabled")||d.abort(u)||(p=function(){0<d.getThumbs(".file-uploading").length||d.fileBatchCompleted||(d.fileBatchCompleted=!0,setTimeout(function(){l.set(d.id,d.uploadCache.content,d.uploadCache.config,d.uploadCache.tags,d.uploadCache.append);d.hasInitData&&(d.initPreview(),d.initPreviewDeletes());d.setProgress(100);d.unlock();d.clearFileInput();d.raise("filebatchuploadcomplete",[d.filestack,d.getExtraData()])},100))},U=function(){!c||0===g||100<=d.uploadPercent||
(d.uploadCount+=1,v=80+Math.ceil(20*d.uploadCount/g),d.uploadPercent=Math.max(v,d.uploadPercent),d.setProgress(d.uploadPercent),d.initPreviewDeletes())},L=function(){q.removeAttr("disabled");T.removeAttr("disabled");m.removeClass("file-uploading")},B=function(b){n=d.getOutData(b);m.hasClass("file-preview-success")||(d.setThumbStatus(m,"Loading"),r(m,"file-uploading"));q.attr("disabled",!0);T.attr("disabled",!0);c||d.lock();d.raise("filepreupload",[n,k,a]);u=e.extend(u,n);d.abort(u)&&(b.abort(),d.setProgress(100))},
w=function(b,f,g){n=d.getOutData(g,b);u=e.extend(u,n);setTimeout(function(){h(b)||h(b.error)?(d.setThumbStatus(m,"Success"),q.hide(),d.filestack[a]=void 0,d.raise("fileuploaded",[n,k,a]),d.initUploadSuccess(b,m,c),c||d.resetFileStack()):(d.setThumbStatus(m,"Error"),d.showUploadError(b.error,u))},100)},C=function(){setTimeout(function(){U();L();c?p():d.unlock(!1);d.initSuccessThumbs()},100)},t=function(f,g,k){g=d.parseError(f,k,c?b[a].name:null);d.setThumbStatus(m,"Error");u=e.extend(u,d.getOutData(f));
d.showUploadError(g,u)},f.append(d.uploadFileAttr,b[a]),f.append("file_id",a),d.ajaxSubmit(B,w,C,t))},uploadBatch:function(){var a=this,b=a.filestack,c=b.length,d=0<a.filestack.length||!e.isEmptyObject(a.uploadExtraData),g,f,n,k;f={};a.formdata=new FormData;0!==c&&d&&!a.abort(f)&&(g=function(){e.each(b,function(b){a.filestack[b]=void 0});a.clearFileInput()},d=function(b){a.lock();var c=a.getOutData(b);a.showPreview&&a.getThumbs().each(function(){var b=e(this),c=b.find(".kv-file-upload"),d=b.find(".kv-file-remove");
b.hasClass("file-preview-success")||(a.setThumbStatus(b,"Loading"),r(b,"file-uploading"));c.attr("disabled",!0);d.attr("disabled",!0)});a.raise("filebatchpreupload",[c]);a.abort(c)&&b.abort()},f=function(b,c,d){c=a.getOutData(d,b);d=a.getThumbs();var f=h(b.errorkeys)?[]:b.errorkeys;h(b)||h(b.error)?(a.raise("filebatchuploadsuccess",[c]),g(),a.showPreview?(d.each(function(){var b=e(this),c=b.find(".kv-file-upload");b.find(".kv-file-upload").hide();a.setThumbStatus(b,"Success");b.removeClass("file-uploading");
c.removeAttr("disabled")}),a.initUploadSuccess(b)):a.reset()):(a.showPreview&&(d.each(function(){var b=e(this),c=b.find(".kv-file-remove"),d=b.find(".kv-file-upload");b.removeClass("file-uploading");d.removeAttr("disabled");c.removeAttr("disabled");0===f.length?a.setThumbStatus(b,"Error"):-1!==e.inArray(key,f)?a.setThumbStatus(b,"Error"):(b.find(".kv-file-upload").hide(),a.setThumbStatus(b,"Success"),a.filestack[key]=void 0)}),a.initUploadSuccess(b)),a.showUploadError(b.error,c,"filebatchuploaderror"))},
n=function(){a.setProgress(100);a.unlock();a.initSuccessThumbs();a.raise("filebatchuploadcomplete",[a.filestack,a.getExtraData()]);a.clearFileInput()},k=function(b,d,f){d=a.getOutData(b);b=a.parseError(b,f);a.showUploadError(b,d,"filebatchuploaderror");a.uploadFileCount=c-1;a.showPreview&&(a.getThumbs().each(function(){var b=e(this),c=b.attr("data-fileindex");b.removeClass("file-uploading");void 0!==a.filestack[c]&&a.setThumbStatus(b,"Error")}),a.getThumbs().removeClass("file-uploading"),a.getThumbs(" .kv-file-upload").removeAttr("disabled"),
a.getThumbs(" .kv-file-delete").removeAttr("disabled"))},e.each(b,function(c,d){h(b[c])||a.formdata.append(a.uploadFileAttr,d)}),a.ajaxSubmit(d,f,n,k))},uploadExtraOnly:function(){var a=this,b={},c,d,g;a.formdata=new FormData;a.abort(b)||(c=function(c){a.lock();var d=a.getOutData(c);a.raise("filebatchpreupload",[d]);a.setProgress(50);b.data=d;b.xhr=c;a.abort(b)&&(c.abort(),a.setProgress(100))},d=function(b,c,d){c=a.getOutData(d,b);h(b)||h(b.error)?(a.raise("filebatchuploadsuccess",[c]),a.clearFileInput(),
a.initUploadSuccess(b)):a.showUploadError(b.error,c,"filebatchuploaderror")},g=function(c,d,g){d=a.getOutData(c);c=a.parseError(c,g);b.data=d;a.showUploadError(c,d,"filebatchuploaderror")},a.ajaxSubmit(c,d,function(){a.setProgress(100);a.unlock();a.raise("filebatchuploadcomplete",[a.filestack,a.getExtraData()]);a.clearFileInput()},g))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},
resetErrors:function(a){var b=this.$errorContainer;this.isError=!1;this.$container.removeClass("has-error");b.html("");a?b.fadeOut("slow"):b.hide()},showFolderError:function(a){var b=this.$errorContainer;a&&(b.html(this.msgFoldersNotAllowed.repl("{n}",a)),b.fadeIn(800),r(this.$container,"has-error"),this.raise("filefoldererror",[a]))},showUploadError:function(a,b,c){var d=this.$errorContainer;c=c||"fileuploaderror";0===d.find("ul").length?d.html("<ul><li>"+a+"</li></ul>"):d.find("ul").append("<li>"+
a+"</li>");d.fadeIn(800);this.raise(c,[b]);r(this.$container,"has-error");return!0},showError:function(a,b,c){var d=this.$errorContainer;c=c||"fileerror";b=b||{};b.reader=this.reader;d.html(a);d.fadeIn(800);this.raise(c,[b]);this.isUploadable||this.clearFileInput();r(this.$container,"has-error");this.$btnUpload.attr("disabled",!0);return!0},errorHandler:function(a,b){var c=a.target.error;switch(c.code){case c.NOT_FOUND_ERR:this.showError(this.msgFileNotFound.replace("{name}",b));break;case c.SECURITY_ERR:this.showError(this.msgFileSecured.replace("{name}",
b));break;case c.NOT_READABLE_ERR:this.showError(this.msgFileNotReadable.replace("{name}",b));break;case c.ABORT_ERR:this.showError(this.msgFilePreviewAborted.replace("{name}",b));break;default:this.showError(this.msgFilePreviewError.replace("{name}",b))}},parseFileType:function(a){var b,c,d;for(d=0;d<H.length;d+=1)if(c=H[d],b=A(c,this.fileTypeSettings)?this.fileTypeSettings[c]:Q[c],b=b(a.type,a.name)?c:"",!h(b))return b;return"other"},previewDefault:function(a,b,c){if(this.showPreview){var d=N.createObjectURL(a);
e("#"+b);var g=this.previewSettings.other||P.other,f=this.renderFileFooter(a.name,g.width),h=this.getPreviewTemplate("other"),k=b.slice(b.lastIndexOf("-")+1),m="";!0===c&&(m=" btn disabled",f+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>');this.$preview.append("\n"+h.repl("{previewId}",b).repl("{frameClass}",m).repl("{fileindex}",k).repl("{caption}",this.slug(a.name)).repl("{width}",g.width).repl("{height}",g.height).repl("{type}",a.type).repl("{data}",
d).repl("{footer}",f))}},previewFile:function(a,b,c,d,g){if(this.showPreview){var f=this.parseFileType(b),e=this.slug(b.name),k=this.allowedPreviewTypes,m=this.allowedPreviewMimeTypes,l=this.getPreviewTemplate(f),p=A(f,this.previewSettings)?this.previewSettings[f]:P[f],q=parseInt(this.wrapTextLength,10),r=this.wrapIndicator,y=0<=k.indexOf(f),B=h(m)||!h(m)&&-1!==m.indexOf(b.type),m=this.renderFileFooter(e,p.width),L="",k=d.slice(d.lastIndexOf("-")+1);y&&B?("text"===f?(c=String(c.target.result).repl("&",
"&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;"),c.length>q&&(g="text-"+M(),f=.75*window.innerHeight,L=this.getLayoutTemplate("modal").repl("{id}",g).repl("{title}",e).repl("{height}",f).repl("{body}",c),r=r.repl("{title}",e).repl("{dialog}","$('#"+g+"').modal('show')"),c=c.substring(0,q-1)+r),b=l.repl("{previewId}",d).repl("{caption}",e).repl("{frameClass}","").repl("{type}",b.type).repl("{width}",p.width).repl("{height}",p.height).repl("{data}",c).repl("{footer}",
m).repl("{fileindex}",k)+L):b=l.repl("{previewId}",d).repl("{caption}",e).repl("{frameClass}","").repl("{type}",b.type).repl("{data}",g).repl("{width}",p.width).repl("{height}",p.height).repl("{footer}",m).repl("{fileindex}",k),this.$preview.append("\n"+b),this.validateImage(a,d)):this.previewDefault(b,d)}},slugDefault:function(a){return h(a)?"":a.split(/(\\|\/)/g).pop().replace(/[^\w\u00C0-\u017F\-.\\\/ ]+/g,"")},getFileStack:function(a){return this.filestack.filter(function(b){return a?void 0!==
b:void 0!==b&&null!==b})},readFiles:function(a){function b(e){h(d.attr("multiple"))&&(q=1);if(e>=q)c.isUploadable&&0<c.filestack.length?c.raise("filebatchselected",[c.getFileStack()]):c.raise("filebatchselected",[a]),l.removeClass("loading"),k.html("");else{var w=p+"-"+(y+e),C,t=a[e],u=c.slug(t.name),D=(t.size||0)/1E3,x;C="";var F=N.createObjectURL(t),E=0,z,I=c.allowedFileTypes,G=h(I)?"":I.join(", "),J=c.allowedFileExtensions,H=h(J)?"":J.join(", ");h(J)||(C=new RegExp("\\.("+J.join("|")+")$","i"));
D=D.toFixed(2);if(0<c.maxFileSize&&D>c.maxFileSize)z=c.msgSizeTooLarge.replace("{name}",u).replace("{size}",D).replace("{maxSize}",c.maxFileSize),c.isError=B(z,t,w,e);else{if(!h(I)&&K(I)){for(D=0;D<I.length;D+=1)x=I[D],x=r[x],x=void 0!==x&&x(t.type,u),E+=h(x)?0:x.length;if(0===E){z=c.msgInvalidFileType.replace("{name}",u).replace("{types}",G);c.isError=B(z,t,w,e);return}}if(0===E&&!h(J)&&K(J)&&!h(C)&&(x=u.match(C),E+=h(x)?0:x.length,0===E)){z=c.msgInvalidFileExtension.replace("{name}",u).replace("{extensions}",
H);c.isError=B(z,t,w,e);return}c.showPreview?(0<g.length&&void 0!==FileReader?(k.html(m.replace("{index}",e+1).replace("{files}",q)),l.addClass("loading"),f.onerror=function(a){c.errorHandler(a,u)},f.onload=function(a){c.previewFile(e,t,a,w,F);c.initFileActions()},f.onloadend=function(){z=v.replace("{index}",e+1).replace("{files}",q).replace("{percent}",50).replace("{name}",u);setTimeout(function(){k.html(z);b(e+1);c.updateFileDetails(q)},100);c.raise("fileloaded",[t,w,e,f])},f.onprogress=function(a){a.lengthComputable&&
(a=Math.ceil(a.loaded/a.total*100),z=v.replace("{index}",e+1).replace("{files}",q).replace("{percent}",a).replace("{name}",u),setTimeout(function(){k.html(z)},100))},C=A("text",r)?r.text:Q.text,C(t.type,u)?f.readAsText(t,c.textEncoding):f.readAsArrayBuffer(t)):(c.previewDefault(t,w),setTimeout(function(){b(e+1);c.updateFileDetails(q)},100),c.raise("fileloaded",[t,w,e,f])),c.filestack.push(t)):(c.filestack.push(t),setTimeout(b(e+1),100),c.raise("fileloaded",[t,w,e,f]))}}}this.reader=new FileReader;
var c=this,d=c.$element,g=c.$preview,f=c.reader,l=c.$previewContainer,k=c.$previewStatus,m=c.msgLoading,v=c.msgProgress,p=c.previewInitId,q=a.length,r=c.fileTypeSettings,y=c.filestack.length,B=function(b,d,f,g){var k=e.extend(c.getOutData({},{},a),{id:f,index:g});g={id:f,index:g,file:d,files:a};c.previewDefault(d,f,!0);return c.isUploadable?c.showUploadError(b,k):c.showError(b,g)};b(0);c.updateFileDetails(q,!1)},updateFileDetails:function(a){var b=this.$element,c=this.getFileStack(),b=b.val()||c.length&&
c[0].name||"",b=this.slug(b),c=this.isUploadable?c.length:a,d=l.count(this.id)+c,c=1<c?this.getMsgSelected(d):b;this.isError?(this.$previewContainer.removeClass("loading"),this.$previewStatus.html(""),this.$captionContainer.find(".kv-caption-icon").hide()):this.showFileIcon();this.setCaption(c,this.isError);this.$container.removeClass("file-input-new file-input-ajax-new");1===arguments.length&&this.raise("fileselect",[a,b]);l.count(this.id)&&this.initPreviewDeletes()},change:function(a){var b=this.$element;
if(!this.isUploadable&&h(b.val())&&this.fileInputCleared)this.fileInputCleared=!1;else{this.fileInputCleared=!1;var c,d,g;d=this.$preview;var f=(c=1<arguments.length)?a.originalEvent.dataTransfer.files:b.get(0).files,b=h(b.attr("multiple"));g=0;var n,k=0,m=this.filestack.length,v=this.isUploadable;this.reader=null;this.resetUpload();this.hideFileIcon();this.isUploadable&&this.$container.find(".file-drop-zone ."+this.dropZoneTitleClass).remove();if(c)for(c=[];f[g];)n=f[g],n.type||0!==n.size%4096?c.push(n):
k++,g++;else c=void 0===a.target.files?a.target&&a.target.value?[{name:a.target.value.replace(/^.+\\/,"")}]:[]:a.target.files;h(c)||0===c.length?(v||this.clear(),this.showFolderError(k),this.raise("fileselectnone")):(this.resetErrors(),g=this.isUploadable?this.getFileStack().length+c.length:c.length,0<this.maxFileCount&&g>this.maxFileCount?(d=this.msgFilesTooMany.replace("{m}",this.maxFileCount).replace("{n}",g),b=e.extend(this.getOutData({},{},f),{id:null,index:null}),f={id:null,index:null,file:null,
files:f},this.isError=this.isUploadable?this.showUploadError(d,b):this.showError(d,f),this.$captionContainer.find(".kv-caption-icon").hide(),this.setCaption("",!0),this.setEllipsis(),this.$container.removeClass("file-input-new file-input-ajax-new")):(!v||b&&0<m?(this.hasInitialPreview()?(f=l.out(this.id),d.html(f.content),this.setCaption(f.caption),this.initPreviewDeletes()):this.clearPreview(),b&&0<m&&(this.filestack=[])):!v||0!==m||l.count(this.id)&&!this.overwriteInitial||(this.clearPreview(),
this.filestack=[]),this.isPreviewable?this.readFiles(c):this.updateFileDetails(1),this.showFolderError(k)))}},validateImage:function(a,b){var c=this,d=c.$preview,g,f,e,k,h=d.find("#"+b),l="Untitled",p=h.find("img");if(p.length)p.on("load",function(){f=h.width();e=d.width();f>e&&(p.css("width","100%"),h.css("width","97%"));k=p.closest(".file-preview-frame").find(".file-caption-name");k.length&&(k.width(p.width()),l=k.text(),k.attr("title",l));g={ind:a,id:b};c.checkDimensions(a,"Small",p,h,l,"Width",
g);c.checkDimensions(a,"Small",p,h,l,"Height",g);c.checkDimensions(a,"Large",p,h,l,"Width",g);c.checkDimensions(a,"Large",p,h,l,"Height",g);c.raise("fileimageloaded",[b]);N.revokeObjectURL(p.attr("src"))})},checkDimensions:function(a,b,c,d,e,f,l){var k=this[("Small"===b?"min":"max")+"Image"+f];!h(k)&&c.length&&(c=c[0],c="Width"===f?c.naturalWidth||c.width:c.naturalHeight||c.height,("Small"===b?c>=k:c<=k)||(b=this["msgImage"+f+b].replace("{name}",e).replace("{size}",k),this.showUploadError(b,l),this.setThumbStatus(d,
"Error"),this.filestack[a]=null))},initCaption:function(){var a=this.initialCaption||"";if(this.overwriteInitial||h(a))return this.$caption.html(""),!1;this.setCaption(a);return!0},setCaption:function(a,b){var c,d;if(b)c=e("<div>"+this.msgValidationError+"</div>").text(),d='<span class="'+this.msgValidationErrorClass+'">'+this.msgValidationErrorIcon+c+"</span>";else{if(h(a)||0===this.$caption.length)return;c=e("<div>"+a+"</div>").text();d=this.getLayoutTemplate("icon")+c}this.$caption.html(d);this.$caption.attr("title",
c);this.$captionContainer.find(".file-caption-ellipsis").attr("title",c);this.setEllipsis()},initBrowse:function(a){this.$btnFile=a.find(".btn-file");this.$btnFile.append(this.$element)},createContainer:function(){var a=e(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(this.renderMain());this.$element.before(a);this.initBrowse(a);return a},refreshContainer:function(){var a=this.$container;a.before(this.$element);a.html(this.renderMain());this.initBrowse(a)},renderMain:function(){var a=
this.isUploadable&&this.dropZoneEnabled?" file-drop-zone":"",a=this.showPreview?this.getLayoutTemplate("preview").repl("{class}",this.previewClass).repl("{dropClass}",a):"",b=this.captionTemplate.repl("{class}",(this.isDisabled?this.captionClass+" file-caption-disabled":this.captionClass)+" kv-fileinput-caption");return this.mainTemplate.repl("{class}",this.mainClass).repl("{preview}",a).repl("{caption}",b).repl("{upload}",this.renderUpload()).repl("{remove}",this.renderRemove()).repl("{cancel}",
this.renderCancel()).repl("{browse}",this.renderBrowse())},renderBrowse:function(){var a=this.browseClass+" btn-file",b="";this.isDisabled&&(b=" disabled ");return'<div class="'+a+'"'+b+"> "+this.browseIcon+this.browseLabel+" </div>"},renderRemove:function(){var a=this.removeClass+" fileinput-remove fileinput-remove-button",b="";if(!this.showRemove)return"";this.isDisabled&&(b=" disabled ");return'<button type="button" title="'+this.removeTitle+'" class="'+a+'"'+b+">"+this.removeIcon+this.removeLabel+
"</button>"},renderCancel:function(){return this.showCancel?'<button type="button" title="'+this.cancelTitle+'" class="hide '+(this.cancelClass+" fileinput-cancel fileinput-cancel-button")+'">'+this.cancelIcon+this.cancelLabel+"</button>":""},renderUpload:function(){var a=this.uploadClass+" kv-fileinput-upload fileinput-upload-button",b="",b="";if(!this.showUpload)return"";this.isDisabled&&(b=" disabled ");return b=!this.isUploadable||this.isDisabled?'<button type="submit" title="'+this.uploadTitle+
'"class="'+a+'"'+b+">"+this.uploadIcon+this.uploadLabel+"</button>":'<a href="'+this.uploadUrl+'" title="'+this.uploadTitle+'" class="'+a+'"'+b+">"+this.uploadIcon+this.uploadLabel+"</a>"}};e.fn.fileinput=function(a){if(window.File&&window.FileReader||F(9)){var b=Array.apply(null,arguments);b.shift();return this.each(function(){var c=e(this),d=c.data("fileinput"),g="object"===typeof a&&a,f=g.language||c.data("language")||"en";d||(d=e.extend({},e.fn.fileinput.defaults),"en"===f||h(e.fn.fileinputLocales[f])||
(d=e.extend(d,e.fn.fileinputLocales[f])),d=new O(this,e.extend(d,g,c.data())),c.data("fileinput",d));"string"===typeof a&&d[a].apply(d,b)})}};e.fn.fileinput.defaults={language:"en",showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showUploadedThumbs:!0,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,
deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:R,previewTemplates:S,allowedPreviewTypes:H,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:P,fileTypeSettings:Q,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i> ',removeClass:"btn btn-default",
cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",
progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},
otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0};e.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',
msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',
msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',
msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',dropZoneTitle:"Drag & drop files here &hellip;"};e.extend(e.fn.fileinput.defaults,e.fn.fileinputLocales.en);e.fn.fileinput.Constructor=O;e(document).ready(function(){var a=e("input.file[type=file]");a.length&&a.fileinput()})})(window.jQuery);